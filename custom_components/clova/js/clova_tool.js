const clovaIcons = {
  clova: {
    path: "M6.785,0.462a6.963,6.963,0,0,1,4.062,1.031c0.263,0.166.507,0.368,0.754,0.554a1.971,1.971,0,0,0,.415.369,1.373,1.373,0,0,1,.308-0.277c0.06-.045.108-0.124,0.169-0.169,0.167-.125.331-0.236,0.508-0.354A7.877,7.877,0,0,1,15.015.677c0.274-.09.573-0.1,0.861-0.169l0.262-.015A3.5,3.5,0,0,1,17.215.477l0.354,0.015c0.348,0.081.706,0.093,1.031,0.2a6.892,6.892,0,0,1,3.692,2.615,6.272,6.272,0,0,1,.631,1.046,10.88,10.88,0,0,1,.523,1.662c0.065,0.25.017,0.5,0.077,0.769a2.631,2.631,0,0,1,0,.877q-0.008.177-.015,0.354L23.369,8.8a10.5,10.5,0,0,1-.477,1.354,7.155,7.155,0,0,1-.861,1.354,2.914,2.914,0,0,0-.446.508,1.371,1.371,0,0,1,.277.308c0.046,0.06.124,0.108,0.169,0.169,0.125,0.167.236,0.331,0.354,0.508a7.877,7.877,0,0,1,.939,2.015c0.088,0.269.1,0.566,0.169,0.846l0.015,0.277a3.5,3.5,0,0,1,.015,1.077q-0.008.177-.015,0.354c-0.081.348-.093,0.706-0.2,1.031a6.892,6.892,0,0,1-2.615,3.692,6.275,6.275,0,0,1-1.046.631,10.88,10.88,0,0,1-1.662.523c-0.25.065-.5,0.017-0.769,0.077a2.631,2.631,0,0,1-.877,0l-0.354-.015L15.2,23.369a10.5,10.5,0,0,1-1.354-.477,7.155,7.155,0,0,1-1.354-.861,2.914,2.914,0,0,0-.508-0.446,1.371,1.371,0,0,1-.308.277c-0.06.046-.108,0.124-0.169,0.169-0.167.125-.331,0.236-0.508,0.354a7.878,7.878,0,0,1-2.015.939c-0.274.09-.573,0.1-0.862,0.169l-0.262.015a3.5,3.5,0,0,1-1.077.015l-0.354-.015c-0.348-.081-0.706-0.093-1.031-0.2a6.891,6.891,0,0,1-3.692-2.615,6.277,6.277,0,0,1-.631-1.046,10.875,10.875,0,0,1-.523-1.662c-0.065-.25-0.017-0.5-0.077-0.769a2.629,2.629,0,0,1,0-.877l0.015-.354L0.631,15.2a10.506,10.506,0,0,1,.477-1.354,7.155,7.155,0,0,1,.862-1.354,2.916,2.916,0,0,0,.446-0.508,1.374,1.374,0,0,1-.277-0.308c-0.045-.06-0.124-0.108-0.169-0.169C1.844,11.34,1.733,11.177,1.615,11A7.848,7.848,0,0,1,.677,8.985C0.588,8.71.577,8.411,0.508,8.123L0.492,7.862A3.514,3.514,0,0,1,.477,6.785l0.015-.354c0.081-.348.094-0.706,0.2-1.031A7.009,7.009,0,0,1,3.338,1.662,7.732,7.732,0,0,1,5.4.692C5.688,0.6,6.005.579,6.308,0.508A2.536,2.536,0,0,0,6.785.462ZM6.877,3.877a1.014,1.014,0,0,1-.231.031,4.852,4.852,0,0,0-.492.123,3.437,3.437,0,0,0-1.431.938,4.211,4.211,0,0,0-.692,1.246c-0.066.2-.074,0.417-0.123,0.631V7.092A2.863,2.863,0,0,0,4,7.923a4.629,4.629,0,0,0,.154.523A4.875,4.875,0,0,0,5.292,9.923a5.946,5.946,0,0,1,1.231,1.369,1.37,1.37,0,0,1,.154.723,2.651,2.651,0,0,1-.169.646,3.493,3.493,0,0,1-.708.785,7.34,7.34,0,0,0-1.554,1.831,3.017,3.017,0,0,0-.338,1.431v0.323c0.049,0.213.057,0.433,0.123,0.631a3.436,3.436,0,0,0,.446.923A3.772,3.772,0,0,0,5.585,19.6a3.479,3.479,0,0,0,.831.323A2.314,2.314,0,0,0,7.2,20H7.508c0.212-.049.43-0.057,0.631-0.123a5.589,5.589,0,0,0,2.2-1.646,3.514,3.514,0,0,1,1.046-.892,2.1,2.1,0,0,1,.354-0.077,1.074,1.074,0,0,1,.461-0.015,2.758,2.758,0,0,1,1.431,1.015,8.527,8.527,0,0,0,1.385,1.262,3.8,3.8,0,0,0,.615.277,2.7,2.7,0,0,0,1.138.2h0.292a5.785,5.785,0,0,0,.677-0.139,4.208,4.208,0,0,0,1.092-.585,3.062,3.062,0,0,0,.831-1.046,4.331,4.331,0,0,0,.323-0.877,3.069,3.069,0,0,0-.046-1.4,4.214,4.214,0,0,0-.262-0.754,6.743,6.743,0,0,0-1.338-1.554,3.374,3.374,0,0,1-.985-1.215,1.153,1.153,0,0,1-.092-0.569,2.65,2.65,0,0,1,.169-0.646,4.883,4.883,0,0,1,.938-1.015,5.853,5.853,0,0,0,1.492-1.954A4.576,4.576,0,0,0,20.015,7.6a3.1,3.1,0,0,0-.108-1.323,3.251,3.251,0,0,0-1.954-2.169,3,3,0,0,0-1.215-.231H16.431a4.946,4.946,0,0,0-1.2.354,7.669,7.669,0,0,0-1.708,1.492,3.2,3.2,0,0,1-.969.815,2.1,2.1,0,0,1-.354.077,1.074,1.074,0,0,1-.461.015,3.151,3.151,0,0,1-1.554-1.138A6.373,6.373,0,0,0,8.708,4.231a4.92,4.92,0,0,0-1.2-.354H6.877Z",
    keywords: ["clova", "clova home extension"],
  },
};

window.customIcons = window.customIcons || {};
window.customIconsets = window.customIconsets || {};

// For Home Assistant > 2021.11
window.customIcons["clova"] = {
  getIcon: async (iconName) => (
    { path: clovaIcons[iconName]?.path }
  ),
  getIconList: async () =>
    Object.entries(clovaIcons).map(([icon, content]) => ({
      name: icon,
      keywords: content.keywords,
    })
    )
};

// For Home Assistant < 2021.11
window.customIconsets["clova"] = async () => {
  return {
    path: clovaIcons.clova.path
  };
};

["location-changed", "load", "popstate"].map(
  (ev) => window.addEventListener(ev, async(ev) => {

    if(window.location.pathname !== "/config/integrations") return;

    let arr = [];
    let integrationCard;

    while (!arr.includes("clova")) {
      await new Promise((resolve) => {
        integrationCard = document.querySelector("home-assistant")?.
          shadowRoot?.querySelector("home-assistant-main")?.
          shadowRoot?.querySelector("ha-config-integrations")?.
          shadowRoot?.querySelectorAll("hass-tabs-subpage > div.container > ha-integration-card");
        integrationCard?.forEach((integration)=>arr.push(integration.dataset.domain));
        window.setTimeout(resolve, 500);
      })
    }
    
    const idx = arr.indexOf("clova");
    const clovaIntegrationCard = integrationCard[idx];

    const button = document.createElement("mwc-button");
    const a = document.createElement("a");

    a.appendChild(button)
    a.setAttribute("href", "../../clova");
    button.innerText = document.querySelector("home-assistant").hass.localize(
      "ui.panel.config.integrations.config_entry.configure"
    );
    clovaIntegrationCard.shadowRoot.querySelector("ha-card > div.actions > div").appendChild(a);
  })
);